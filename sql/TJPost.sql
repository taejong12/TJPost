-- SYSTEM 스키마
-- 사용자 생성
CREATE USER C##TJPost IDENTIFIED BY 1234;

-- CONNECT: 사용자가 DB에 접속할 수 있는 권한
-- RESOURCE: 데이터를 생성, 수정, 삭제할 수 있는 권한
GRANT CONNECT, RESOURCE TO C##TJPost;

--system 에서 유저 권한 줘야 에러 없이 DB 에 저장 가능
--QUOTA : 테이블 공간 사용 
ALTER USER C##TJPost DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS;

-------------------------------------------------------------------------------------------
-- TJPost 스키마

-- 공지사항 테이블 생성
CREATE TABLE BOARD (
    BOARD_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BOARD_TITLE VARCHAR2(255) NOT NULL,
    BOARD_CONTENT VARCHAR2(4000) NOT NULL,
    BOARD_CREATE DATE DEFAULT SYSDATE,
    BOARD_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR2(30) NOT NULL
);

-- 회원 테이블 생성
CREATE TABLE MEMBER (
    MEMBER_ID VARCHAR2(30) PRIMARY KEY,
    MEMBER_PASSWORD VARCHAR2(255) NOT NULL,
    MEMBER_NAME VARCHAR2(100) NOT NULL,
    MEMBER_PHONENUMBER VARCHAR2(15) UNIQUE NOT NULL,
    MEMBER_EMAIL VARCHAR2(255) UNIQUE NOT NULL,
    MEMBER_ENABLED CHAR(1) DEFAULT 'Y' NOT NULL,
    MEMBER_CREATE DATE DEFAULT SYSDATE,
    MEMBER_UPDATE DATE DEFAULT SYSDATE
);

ALTER TABLE MEMBER DROP COLUMN MEMBER_FILE;

-- 회원권한 테이블
CREATE TABLE AUTHORITIES (
    AUTHORITIES_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AUTHORITIES_AUTHORITY VARCHAR(50) DEFAULT 'ROLE_USER' NOT NULL,
    MEMBER_ID VARCHAR(50) NOT NULL,
    CONSTRAINT FK_MEMBER_ID FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE
);

-- 상품 테이블
CREATE TABLE PRODUCT (
    PRODUCT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PRODUCT_NAME VARCHAR(50) NOT NULL,
    PRODUCT_PRICE NUMBER NOT NULL,
    PRODUCT_CONTENT VARCHAR(255) NOT NULL,
    PRODUCT_STOCK NUMBER NOT NULL,
    PRODUCT_CATEGORY VARCHAR(50) NOT NULL,
    PRODUCT_CREATE DATE DEFAULT SYSDATE,
    PRODUCT_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR(30) NOT NULL
);

-- 파일 테이블
CREATE TABLE COMMON_FILE (
    FILE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FILE_NAME VARCHAR(255) NOT NULL,
    FILE_ORIGINALNAME VARCHAR(255) NOT NULL,
    FILE_PATH VARCHAR(255) NOT NULL,
    FILE_CREATE DATE DEFAULT SYSDATE,
    FILE_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR(30),
    BOARD_ID NUMBER,
    PRODUCT_ID NUMBER
);

desc BOard;
--PRODUCT 테이블 컬럼설명
COMMENT ON COLUMN PRODUCT.PRODUCT_ID IS '상품_아이디(PK)';
COMMENT ON COLUMN PRODUCT.PRODUCT_NAME IS '상품_이름';
COMMENT ON COLUMN PRODUCT.PRODUCT_PRICE IS '상품_가격';
COMMENT ON COLUMN PRODUCT.PRODUCT_CONTENT IS '상품_내용';
COMMENT ON COLUMN PRODUCT.PRODUCT_STOCK IS '상품_재고';
COMMENT ON COLUMN PRODUCT.PRODUCT_CATEGORY IS '상품_종류';
COMMENT ON COLUMN PRODUCT.PRODUCT_CREATE IS '상품_생성일(기본값: 현재날짜)';
COMMENT ON COLUMN PRODUCT.PRODUCT_UPDATE IS '상품_수정일(기본값: 현재날짜)';
COMMENT ON COLUMN PRODUCT.MEMBER_ID IS '상품_등록아이디';

--BOARD 테이블 컬럼설명
COMMENT ON COLUMN BOARD.BOARD_ID IS '공지사항_아이디(PK)';
COMMENT ON COLUMN BOARD.BOARD_TITLE IS '공지사항_제목';
COMMENT ON COLUMN BOARD.BOARD_CONTENT IS '공지사항_내용';
COMMENT ON COLUMN BOARD.MEMBER_ID IS '공지사항_작성자';
COMMENT ON COLUMN BOARD.BOARD_CREATE IS '공지사항_생성일(기본값: 현재날짜)';
COMMENT ON COLUMN BOARD.BOARD_UPDATE IS '공지사항_수정일(기본값: 현재날짜)';

--MEMBER 테이블 컬럼설명
COMMENT ON COLUMN MEMBER.MEMBER_ID IS '회원_아이디(PK)';
COMMENT ON COLUMN MEMBER.MEMBER_PASSWORD IS '회원_비밀번호';
COMMENT ON COLUMN MEMBER.MEMBER_NAME IS '회원_이름';
COMMENT ON COLUMN MEMBER.MEMBER_PHONENUMBER IS '회원_핸드폰번호';
COMMENT ON COLUMN MEMBER.MEMBER_EMAIL IS '회원_이메일';
COMMENT ON COLUMN MEMBER.MEMBER_ENABLED IS '회원_계정활성화(기본값: Y(활성화), N(비활성화))-휴면회원';
COMMENT ON COLUMN MEMBER.MEMBER_CREATE IS '회원_생성일(기본값: 현재날짜)';
COMMENT ON COLUMN MEMBER.MEMBER_UPDATE IS '회원_수정일(기본값: 현재날짜)';

--AUTHORITIES 테이블 컬럼설명
COMMENT ON COLUMN AUTHORITIES.AUTHORITIES_ID IS '회원권한_아이디(PK)';
COMMENT ON COLUMN AUTHORITIES.AUTHORITIES_AUTHORITY IS '회원권한_권한(기본값: ROLE_USER(회원), ROLE_ADMIN(관리자))';
COMMENT ON COLUMN AUTHORITIES.MEMBER_ID IS '회원권한_회원아이디(FK(ON DELETE CASCADE))';



