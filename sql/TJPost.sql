-- SYSTEM 스키마
-- 사용자 생성
CREATE USER C##TJPost IDENTIFIED BY 1234;

-- CONNECT: 사용자가 DB에 접속할 수 있는 권한
-- RESOURCE: 데이터를 생성, 수정, 삭제할 수 있는 권한
GRANT CONNECT, RESOURCE TO C##TJPost;

--system 에서 유저 권한 줘야 에러 없이 DB 에 저장 가능
--QUOTA : 테이블 공간 사용 
ALTER USER C##TJPost DEFAULT TABLESPACE USERS QUOTA UNLIMITED ON USERS;

-------------------------------------------------------------------------------------------
-- TJPost 스키마

-- 공지사항 테이블 생성
CREATE TABLE BOARD (
    BOARD_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BOARD_TITLE VARCHAR2(255) NOT NULL,
    BOARD_CONTENT VARCHAR2(4000) NOT NULL,
    BOARD_CREATE DATE DEFAULT SYSDATE,
    BOARD_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR2(30) NOT NULL
);

-- 회원 테이블 생성
CREATE TABLE MEMBER (
    MEMBER_ID VARCHAR2(30) PRIMARY KEY,
    MEMBER_PASSWORD VARCHAR2(255) NOT NULL,
    MEMBER_NAME VARCHAR2(100) NOT NULL,
    MEMBER_PHONENUMBER VARCHAR2(15) UNIQUE NOT NULL,
    MEMBER_EMAIL VARCHAR2(255) UNIQUE NOT NULL,
    MEMBER_ENABLED CHAR(1) DEFAULT 'Y' NOT NULL,
    MEMBER_CREATE DATE DEFAULT SYSDATE,
    MEMBER_UPDATE DATE DEFAULT SYSDATE
);

-- 회원권한 테이블
CREATE TABLE AUTHORITIES (
    AUTHORITIES_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    AUTHORITIES_AUTHORITY VARCHAR(50) DEFAULT 'ROLE_USER' NOT NULL,
    MEMBER_ID VARCHAR(50) NOT NULL,
    CONSTRAINT FK_MEMBER_ID FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER(MEMBER_ID) ON DELETE CASCADE
);

-- 상품 테이블
CREATE TABLE PRODUCT (
    PRODUCT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PRODUCT_NAME VARCHAR(50) NOT NULL,
    PRODUCT_PRICE NUMBER NOT NULL,
    PRODUCT_CONTENT VARCHAR(255) NOT NULL,
    PRODUCT_STOCK NUMBER NOT NULL,
    PRODUCT_CATEGORY VARCHAR(50) NOT NULL,
    PRODUCT_CREATE DATE DEFAULT SYSDATE,
    PRODUCT_UPDATE DATE DEFAULT SYSDATE,
    PRODUCT_TOTALSALESCOUNT NUMBER DEFAULT '0',
    MEMBER_ID VARCHAR(30) NOT NULL
);

-- 파일 테이블
CREATE TABLE COMMON_FILE (
    FILE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FILE_NAME VARCHAR(255) NOT NULL,
    FILE_ORIGINALNAME VARCHAR(255) NOT NULL,
    FILE_PATH VARCHAR(255) NOT NULL,
    FILE_CREATE DATE DEFAULT SYSDATE,
    FILE_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR(30),
    BOARD_ID NUMBER,
    PRODUCT_ID NUMBER
);

-- 주소 테이블
CREATE TABLE ADDRESS (
    ADDRESS_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ADDRESS_NAME VARCHAR(30) NOT NULL,
    ADDRESS_ROADADDRESS VARCHAR(255) NOT NULL,
    ADDRESS_DETAILADDRESS VARCHAR(255) NOT NULL,
    ADDRESS_POSTCODE VARCHAR(10) NOT NULL,
    ADDRESS_PHONENUMBER VARCHAR(15) NOT NULL,
    ADDRESS_DEFAULTADDRESS CHAR(1) DEFAULT 'N' NOT NULL,
    ADDRESS_CREATE DATE DEFAULT SYSDATE,
    ADDRESS_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR(30) NOT NULL
);

-- 주문내역 테이블
CREATE TABLE ORDERS (
    ORDERS_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORDERS_TOTALCOUNT NUMBER NOT NULL,
    ORDERS_TOTALPRICE NUMBER NOT NULL,
    ORDERS_PAYMENTMETHOD VARCHAR(20) NOT NULL,
    ORDERS_STATUS VARCHAR(20) DEFAULT '결제완료' NOT NULL, -- 결제완료, 결제취소
    ORDERS_CREATE DATE DEFAULT SYSDATE,
    ORDERS_UPDATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR(30) NOT NULL
);

-- 주문내역 상세 테이블
CREATE TABLE ORDERS_DETAIL (
    ORDERS_DETAIL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORDERS_DETAIL_PRODUCTNAME VARCHAR(50) NOT NULL,
    ORDERS_DETAIL_PRODUCTPRICE NUMBER NOT NULL,
    ORDERS_DETAIL_PRODUCTCOUNT NUMBER NOT NULL,
    ORDERS_DETAIL_PRODUCTPAYPRICE NUMBER NOT NULL,
    ORDERS_DETAIL_STATUS VARCHAR(20) DEFAULT '배송준비' NOT NULL, -- 배송준비, 배송중, 배송완료, 교환, 환불
    ORDERS_DETAIL_CREATE DATE DEFAULT SYSDATE,
    ORDERS_DETAIL_UPDATE DATE DEFAULT SYSDATE,
    ORDERS_ID NUMBER NOT NULL,
    PRODUCT_ID NUMBER,
    DELIVERY_ID NUMBER
);

-- 배송테이블
CREATE TABLE DELIVERY (
    DELIVERY_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DELIVERY_TRACKINGNUMBER VARCHAR(50), -- 송장번호
    DELIVERY_STATUS VARCHAR(20) DEFAULT '배송준비' NOT NULL, -- 배송준비, 배송중, 배송완료
    DELIVERY_ADDRESSNAME VARCHAR(30) NOT NULL,
    DELIVERY_ROADADDRESS VARCHAR(255) NOT NULL,
    DELIVERY_DETAILADDRESS VARCHAR(255) NOT NULL,
    DELIVERY_POSTCODE VARCHAR(10) NOT NULL,
    DELIVERY_PHONENUMBER VARCHAR(15) NOT NULL,
    DELIVERY_CREATE DATE DEFAULT SYSDATE,
    DELIVERY_UPDATE DATE DEFAULT SYSDATE,
    DELIVERY_START DATE,
    DELIVERY_END DATE,
    ORDERS_ID NUMBER NOT NULL,
    ORDERS_DETAIL_ID NUMBER NOT NULL
);

-- 장바구니 테이블
CREATE TABLE CART (
    CART_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CART_PRODUCTNAME VARCHAR(50) NOT NULL,
    CART_PRODUCTPRICE NUMBER NOT NULL,
    CART_COUNT NUMBER NOT NULL,
    CART_TOTALPRICE NUMBER NOT NULL,
    CART_CREATE DATE DEFAULT SYSDATE,
    MEMBER_ID VARCHAR(30) NOT NULL,
    PRODUCT_ID NUMBER NOT NULL
);


-- 교환/환불 테이블
CREATE TABLE ORDERS_RETURN (
    ORDERS_RETURN_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORDERS_ID NUMBER NOT NULL,
    ORDERS_RETURN_TYPE VARCHAR(20) NOT NULL, -- 교환, 환불
    ORDERS_RETURN_REASON VARCHAR(255), -- 사유
    ORDERS_RETURN_STATUS VARCHAR(20) DEFAULT '처리중' NOT NULL, -- 처리중, 완료
    ORDERS_RETURN_PRICE NUMBER,
    ORDERS_RETURN_CREATE DATE DEFAULT SYSDATE,
    ORDERS_RETURN_UPDATE DATE DEFAULT SYSDATE
);

--PRODUCT 테이블 컬럼설명
COMMENT ON COLUMN PRODUCT.PRODUCT_ID IS '상품_아이디(PK)';
COMMENT ON COLUMN PRODUCT.PRODUCT_NAME IS '상품_이름';
COMMENT ON COLUMN PRODUCT.PRODUCT_PRICE IS '상품_가격';
COMMENT ON COLUMN PRODUCT.PRODUCT_CONTENT IS '상품_내용';
COMMENT ON COLUMN PRODUCT.PRODUCT_STOCK IS '상품_재고';
COMMENT ON COLUMN PRODUCT.PRODUCT_CATEGORY IS '상품_종류';
COMMENT ON COLUMN PRODUCT.PRODUCT_CREATE IS '상품_생성일(기본값: 현재날짜)';
COMMENT ON COLUMN PRODUCT.PRODUCT_UPDATE IS '상품_수정일(기본값: 현재날짜)';
COMMENT ON COLUMN PRODUCT.MEMBER_ID IS '상품_등록아이디';

--BOARD 테이블 컬럼설명
COMMENT ON COLUMN BOARD.BOARD_ID IS '공지사항_아이디(PK)';
COMMENT ON COLUMN BOARD.BOARD_TITLE IS '공지사항_제목';
COMMENT ON COLUMN BOARD.BOARD_CONTENT IS '공지사항_내용';
COMMENT ON COLUMN BOARD.MEMBER_ID IS '공지사항_작성자';
COMMENT ON COLUMN BOARD.BOARD_CREATE IS '공지사항_생성일(기본값: 현재날짜)';
COMMENT ON COLUMN BOARD.BOARD_UPDATE IS '공지사항_수정일(기본값: 현재날짜)';

--MEMBER 테이블 컬럼설명
COMMENT ON COLUMN MEMBER.MEMBER_ID IS '회원_아이디(PK)';
COMMENT ON COLUMN MEMBER.MEMBER_PASSWORD IS '회원_비밀번호';
COMMENT ON COLUMN MEMBER.MEMBER_NAME IS '회원_이름';
COMMENT ON COLUMN MEMBER.MEMBER_PHONENUMBER IS '회원_핸드폰번호';
COMMENT ON COLUMN MEMBER.MEMBER_EMAIL IS '회원_이메일';
COMMENT ON COLUMN MEMBER.MEMBER_ENABLED IS '회원_계정활성화(기본값: Y(활성화), N(비활성화))-휴면회원';
COMMENT ON COLUMN MEMBER.MEMBER_CREATE IS '회원_생성일(기본값: 현재날짜)';
COMMENT ON COLUMN MEMBER.MEMBER_UPDATE IS '회원_수정일(기본값: 현재날짜)';

--AUTHORITIES 테이블 컬럼설명
COMMENT ON COLUMN AUTHORITIES.AUTHORITIES_ID IS '회원권한_아이디(PK)';
COMMENT ON COLUMN AUTHORITIES.AUTHORITIES_AUTHORITY IS '회원권한_권한(기본값: ROLE_USER(회원), ROLE_ADMIN(관리자))';
COMMENT ON COLUMN AUTHORITIES.MEMBER_ID IS '회원권한_회원아이디(FK(ON DELETE CASCADE))';


			

